# Nginx-Konfiguration für alternative Domain
# Speichern Sie diese als: /etc/nginx/sites-available/[IHRE-ALTERNATIVE-DOMAIN]

server {
    server_name [IHRE-ALTERNATIVE-DOMAIN];

    # Große Uploads erlauben
    client_max_body_size 10G;
    client_body_timeout 600s;
    client_body_buffer_size 128k;

    # Backend API
    location /api/ {
        proxy_pass              http://127.0.0.1:3301;
        proxy_http_version      1.1;
        proxy_set_header        Upgrade $http_upgrade;
        proxy_set_header        Connection 'upgrade';
        proxy_set_header        Host $host;
        proxy_cache_bypass      $http_upgrade;
        
        # Upload-optimierte Einstellungen
        proxy_buffering         off;
        proxy_request_buffering off;
        proxy_read_timeout      600s;
        proxy_send_timeout      600s;
        proxy_connect_timeout   60s;

        # CORS für Cross-Origin-Uploads
        add_header 'Access-Control-Allow-Origin' 'https://klipz.staubile.de' always;
        add_header 'Access-Control-Allow-Methods' 'GET, POST, PUT, DELETE, OPTIONS' always;
        add_header 'Access-Control-Allow-Headers' 'Authorization,Content-Type' always;
        add_header 'Access-Control-Allow-Credentials' 'true' always;
        
        if ($request_method = OPTIONS) {
            return 204;
        }
    }

    # Statische Dateien auch über alternative Domain
    location /uploads/ {
        alias /var/www/KlipZ/server/uploads/;
        access_log off;
        expires 30d;
        
        # CORS für Medien-Dateien
        add_header 'Access-Control-Allow-Origin' '*' always;
    }

    location /thumbnails/ {
        alias /var/www/KlipZ/server/thumbnails/;
        access_log off;
        expires 30d;
        
        # CORS für Thumbnails
        add_header 'Access-Control-Allow-Origin' '*' always;
    }

    # Alle anderen Anfragen weiterleiten
    location / {
        return 301 https://klipz.staubile.de$request_uri;
    }

    listen 80;
}